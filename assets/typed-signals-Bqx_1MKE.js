var v={},r={};Object.defineProperty(r,"__esModule",{value:!0});r.Collector=void 0;class p{constructor(e){this.emit=(...t)=>{e.emitCollecting(this,t)}}}r.Collector=p;var o={};Object.defineProperty(o,"__esModule",{value:!0});o.CollectorArray=void 0;const _=r;class m extends _.Collector{constructor(){super(...arguments),this.result=[]}handleResult(e){return this.result.push(e),!0}getResult(){return this.result}reset(){this.result.length=0}}o.CollectorArray=m;var s={};Object.defineProperty(s,"__esModule",{value:!0});s.CollectorLast=void 0;const y=r;class S extends y.Collector{handleResult(e){return this.result=e,!0}getResult(){return this.result}reset(){delete this.result}}s.CollectorLast=S;var c={};Object.defineProperty(c,"__esModule",{value:!0});c.CollectorUntil0=void 0;const L=r;class j extends L.Collector{constructor(){super(...arguments),this.result=!1}handleResult(e){return this.result=e,this.result}getResult(){return this.result}reset(){this.result=!1}}c.CollectorUntil0=j;var a={};Object.defineProperty(a,"__esModule",{value:!0});a.CollectorWhile0=void 0;const O=r;class P extends O.Collector{constructor(){super(...arguments),this.result=!1}handleResult(e){return this.result=e,!this.result}getResult(){return this.result}reset(){this.result=!1}}a.CollectorWhile0=P;var u={},h={};Object.defineProperty(h,"__esModule",{value:!0});h.SignalConnectionImpl=void 0;class w{constructor(e,t){this.link=e,this.parentCleanup=t}disconnect(){return this.link!==null?(this.link.unlink(),this.link=null,this.parentCleanup(),this.parentCleanup=null,!0):!1}set enabled(e){this.link&&this.link.setEnabled(e)}get enabled(){return this.link!==null&&this.link.isEnabled()}}h.SignalConnectionImpl=w;var d={};Object.defineProperty(d,"__esModule",{value:!0});d.SignalLink=void 0;class f{constructor(e=null,t=null,l=0){this.enabled=!0,this.newLink=!1,this.callback=null,this.prev=e??this,this.next=t??this,this.order=l}isEnabled(){return this.enabled&&!this.newLink}setEnabled(e){this.enabled=e}unlink(){this.callback=null,this.next.prev=this.prev,this.prev.next=this.next}insert(e,t){let l=this.prev;for(;l!==this&&!(l.order<=t);)l=l.prev;const i=new f(l,l.next,t);return i.callback=e,l.next=i,i.next.prev=i,i}}d.SignalLink=f;Object.defineProperty(u,"__esModule",{value:!0});u.Signal=void 0;const $=h,A=d;class M{constructor(){this.head=new A.SignalLink,this.hasNewLinks=!1,this.emitDepth=0,this.connectionsCount=0}getConnectionsCount(){return this.connectionsCount}hasConnections(){return this.connectionsCount>0}connect(e,t=0){this.connectionsCount++;const l=this.head.insert(e,t);return this.emitDepth>0&&(this.hasNewLinks=!0,l.newLink=!0),new $.SignalConnectionImpl(l,()=>this.decrementConnectionCount())}decrementConnectionCount(){this.connectionsCount--}disconnect(e){for(let t=this.head.next;t!==this.head;t=t.next)if(t.callback===e)return this.decrementConnectionCount(),t.unlink(),!0;return!1}disconnectAll(){for(;this.head.next!==this.head;)this.head.next.unlink();this.connectionsCount=0}emit(...e){this.emitDepth++;for(let t=this.head.next;t!==this.head;t=t.next)t.isEnabled()&&t.callback&&t.callback.apply(null,e);this.emitDepth--,this.unsetNewLink()}emitCollecting(e,t){this.emitDepth++;for(let l=this.head.next;l!==this.head;l=l.next)if(l.isEnabled()&&l.callback){const i=l.callback.apply(null,t);if(!e.handleResult(i))break}this.emitDepth--,this.unsetNewLink()}unsetNewLink(){if(this.hasNewLinks&&this.emitDepth===0){for(let e=this.head.next;e!==this.head;e=e.next)e.newLink=!1;this.hasNewLinks=!1}}}u.Signal=M;var C={};Object.defineProperty(C,"__esModule",{value:!0});C.SignalConnections=void 0;class R{constructor(){this.list=[]}add(e){this.list.push(e)}disconnectAll(){for(const e of this.list)e.disconnect();this.list=[]}getCount(){return this.list.length}isEmpty(){return this.list.length===0}}C.SignalConnections=R;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.SignalConnections=n.Signal=n.CollectorWhile0=n.CollectorUntil0=n.CollectorLast=n.CollectorArray=n.Collector=void 0;var e=r;Object.defineProperty(n,"Collector",{enumerable:!0,get:function(){return e.Collector}});var t=o;Object.defineProperty(n,"CollectorArray",{enumerable:!0,get:function(){return t.CollectorArray}});var l=s;Object.defineProperty(n,"CollectorLast",{enumerable:!0,get:function(){return l.CollectorLast}});var i=c;Object.defineProperty(n,"CollectorUntil0",{enumerable:!0,get:function(){return i.CollectorUntil0}});var g=a;Object.defineProperty(n,"CollectorWhile0",{enumerable:!0,get:function(){return g.CollectorWhile0}});var b=u;Object.defineProperty(n,"Signal",{enumerable:!0,get:function(){return b.Signal}});var k=C;Object.defineProperty(n,"SignalConnections",{enumerable:!0,get:function(){return k.SignalConnections}})})(v);export{v as d};
